# For dashboard sign in token:
# kubectl -n monitoring get secret kubernetes-dashboard -o jsonpath='{.data.token}' | base64 -d
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kubernetes-dashboard
---
apiVersion: v1
kind: Secret
metadata:
  name: admin-user
  namespace: kubernetes-dashboard
  annotations:
    kubernetes.io/service-account.name: "admin-user"   
type: kubernetes.io/service-account-token  
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kubernetes-dashboard
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: auth-middleware
spec:
  headers:
    customRequestHeaders:
      # Hardcoded Bearer token for authorization
      # Authorization: "Bearer {{ index .Values.admin-user.data.token | b64dec }}"
      Authorization: "Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IllPUVgxR18yZGlEYjkwVVhxd2dOa25rV0xiUWRWSmZVS2l5cndNX3hqUHcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJiNmU4ZjQ3Ny02OGEzLTQ2OWUtODdjOC1lMTI4MDlhMGIzNjkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.kc-6Sa5b8WCK95pFNder942nGP4gkf6UP3d6q1-WKFXD4KvktGiYZyL550wxbdAP5bzqgoRQMeOfH7Pha83OcWfhYVrAHm3EhA2YwUxhwkjpfcDUYlckbqNOuzBFlz5mUkqLKv5n8jw2F0XYYHNOrAwsg8wOZUH8GmMhZjM4PV40jKS3ttaPJS7nEWcOguNq-nkfLS2rmrx-gUms-gZZ6pk_354WKASLytLNz3VQbBmqcLDoY2BTyNzJ_4GwIqs_AP8BsF6w541YgDgqjS2IYWLerrafewi_AsNg9u8EtI-_pSpRdiyYNRMxiFYbVeoeeeLj2djOp-bOBTzb0LYNyA"