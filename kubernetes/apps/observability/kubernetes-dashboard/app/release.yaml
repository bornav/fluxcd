apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kubernetes-dashboard
spec:
  interval: 1h
  chart:
    spec:
      chart: kubernetes-dashboard
      version: 7.8.0
      sourceRef:
        kind: HelmRepository
        name: kubernetes-dashboard
        namespace: flux-system
  maxHistory: 2
  install:
    crds: CreateReplace
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    crds: CreateReplace
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    app:
      ingress:
        enabled: true
        # Keep 'localhost' host only if you want to access Dashboard using 'kubectl port-forward ...' on:
        # https://localhost:8443
        # - kubernetes.dashboard.domain.com
        hosts:
        - kubernetes-dashboard.cloud.icylair.com
        ingressClassName: traefik-external
        # Use only if your ingress controllers support default ingress classes.
        # If set to true ingressClassName will be ignored and not added to the Ingress resources.
        # It should fall back to using IngressClass marked as the default.
        useDefaultIngressClass: false
        annotations:
          # traefik.ingress.kubernetes.io/router.middlewares:   
          traefik.ingress.kubernetes.io/router.middlewares: network-forward-auth@kubernetescrd
          # ingress.kubernetes.io/auth-response-headers: X-Forwarded-User
        # This will append our Ingress with annotations required by our default configuration.
        #    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
        #    nginx.ingress.kubernetes.io/ssl-passthrough: "true"
        #    nginx.ingress.kubernetes.io/ssl-redirect: "true"
        useDefaultAnnotations: true
        pathType: ImplementationSpecific
        # If path is not the default (/), rewrite-target annotation will be added to the Ingress.
        # It allows serving Kubernetes Dashboard on a sub-path. Make sure that the configured path
        # does not conflict with gateway route configuration.
        path: /
        issuer:
          name: selfsigned
          # Scope determines what kind of issuer annotation will be used on ingress resource
          # - default - adds 'cert-manager.io/issuer'
          # - cluster - adds 'cert-manager.io/cluster-issuer'
          # - disabled - disables cert-manager annotations
          scope: disabled
        tls:
          # If provided it will override autogenerated secret name
          secretName: "icylair-com-all-prod"
    api:
      containers:
        args:
        # - --enable-skip-login
    auth:
      containers:
        args:
        # - --enable-skip-login
    cert-manager:
      enabled: false
